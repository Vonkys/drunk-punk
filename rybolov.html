<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>üé£ Fishing Wheel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #e7fbff;
      margin: 0; padding: 0;
      text-align: center;
    }
    .zpet-link {
      display: inline-block;
      margin: 18px 0 2px 0;
      color: #1760a3;
      background: #e9f6fd;
      padding: 7px 17px;
      border-radius: 9px;
      text-decoration: none;
      font-weight: bold;
      font-size: 1.08em;
      box-shadow: 0 1px 8px #bbe8fd44;
      transition: background 0.13s, color 0.13s;
      position: relative;
      top: 16px;
      left: 0;
    }
    .zpet-link:hover { background: #b7e0ed; color: #124061; }

    h1 {
      font-size: 2.4em; color: #208278; margin: 24px 0 0 0;
      letter-spacing: 2px;
    }
    .desc {
      color: #217c5e; font-size: 1.3em; margin-bottom: 16px; margin-top: 2px;
      font-weight: 600;
    }
    .wheel-wrap { margin: 32px auto 0 auto; width: 370px; position: relative; }
    canvas { background: #fff; border-radius: 50%; box-shadow: 0 2px 16px #00838f33; }
    .result-box {
      margin-top: 36px; min-height: 60px;
      font-size: 1.25em;
      color: #136652;
      font-weight: 700;
      background: #e6fff3;
      border-radius: 14px;
      display: inline-block;
      padding: 14px 28px 12px 28px;
      box-shadow: 0 2px 12px #7fffd455;
      transition: background 0.18s;
    }
    .fish-emoji {
      font-size: 2.5em; margin-right: 12px;
      vertical-align: middle;
    }
    .spin-btn {
      margin-top: 28px;
      font-size: 1.18em;
      padding: 14px 38px;
      background: #22c984;
      color: #fff;
      border: none;
      border-radius: 11px;
      box-shadow: 0 2px 12px #44a66a25;
      font-weight: 900;
      letter-spacing: 1px;
      cursor: pointer;
      transition: background 0.14s, box-shadow 0.14s;
    }
    .spin-btn:active { background: #139259; }
    @media (max-width: 600px){
      .wheel-wrap { width: 95vw; max-width: 99vw; }
      canvas { width: 95vw !important; height: 95vw !important; }
      .zpet-link { padding: 7px 6vw; font-size:1em; }
    }
  </style>
</head>
<body>
  <a href="vyroba.html" class="zpet-link">‚Üê Back to production</a>
  <h1>üé£ Fishing</h1>
  <div class="desc">Spin the Wheel and Catch Some Stuff!</div>
  <div class="wheel-wrap" style="max-width:380px;">
    <canvas id="wheel" width="340" height="340"></canvas>
  </div>
  <button class="spin-btn" id="spinBtn">Spin & Fish!</button>
  <div class="result-box" id="resultBox"></div>

  <script>
    // Items (EN labels, emojis, and internal key for inventory)
    var fishingItems = [
      { key:"shrimp", label: "Shrimp", emoji:"ü¶ê" },
      { key:"crab", label: "Crab", emoji:"ü¶Ä" },
      { key:"fish", label: "Fish", emoji:"üê†" },
      { key:"octopus", label: "Octopus", emoji:"üêô" },
      { key:"tempura", label: "Tempura", emoji:"üç§" },
      { key:"poop", label: "Poop", emoji:"üí©" },
      { key:"boot", label: "Boot", emoji:"üë¢" }
    ];
    var funkyColors = [
      "#FFD966", "#A1F0E3", "#FFB3BA", "#B5D0FF",
      "#baffc9", "#ffdfba", "#f9b3ff"
    ];
    var blinkColor = "#fff580"; // v√Ωhern√≠ barva bliknut√≠

    var n = fishingItems.length;
    var wheel = document.getElementById("wheel");
    var ctx = wheel.getContext("2d");
    var radius = wheel.width/2;
    var spinning = false;
    var lastResult = null;
    var highlightIndex = null; // Index segmentu co blik√°
    var blinkState = false;    // true kdy≈æ se m√° zv√Ωraznit

    // Hlavn√≠ zmƒõna je tady:
    function addToInventory(key) {
      if(key === "boot" || key === "poop") return; // don't count junk
      // Ulo≈æ p≈ô√≠mo do hlavn√≠ho skladu hry (lihobaronFarmStorage)
      var sklad = JSON.parse(localStorage.getItem("lihobaronFarmStorage") || "{}");
      sklad[key] = (sklad[key] || 0) + 1;
      localStorage.setItem("lihobaronFarmStorage", JSON.stringify(sklad));
    }
    function renderResult(item) {
      var resultBox = document.getElementById("resultBox");
      if (item.key === "boot" || item.key === "poop") {
        resultBox.innerHTML = "<span class='fish-emoji'>" + item.emoji + "</span> Oh no! You caught " + item.label + "!";
      } else {
        resultBox.innerHTML = "<span class='fish-emoji'>" + item.emoji + "</span> Nice! You caught <b>" + item.label + "</b>!";
      }
    }

    // --- Wheel Drawing ---
    function drawWheel(angle, highlight) {
      ctx.clearRect(0,0,wheel.width,wheel.height);
      var anglePer = 2*Math.PI/n;
      for(var i=0;i<n;i++){
        ctx.beginPath();
        ctx.moveTo(radius, radius);
        ctx.arc(radius, radius, radius-7, angle+i*anglePer, angle+(i+1)*anglePer);
        ctx.closePath();
        ctx.fillStyle = (highlight && highlight.i === i && blinkState) ? blinkColor : funkyColors[i % funkyColors.length];
        ctx.fill();
        ctx.save();
        // Draw emoji + text
        var mid = angle+(i+0.5)*anglePer;
        ctx.translate(
          radius + Math.cos(mid)*(radius-65),
          radius + Math.sin(mid)*(radius-65)
        );
        ctx.rotate(mid+Math.PI/2);
        ctx.font = "2.0em Segoe UI Emoji";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(fishingItems[i].emoji, 0, 0);
        ctx.font = "1.1em Segoe UI,Arial";
        ctx.fillStyle = "#267b89";
        ctx.fillText(fishingItems[i].label, 0, 32);
        ctx.restore();
      }
      // Outline
      ctx.beginPath();
      ctx.arc(radius, radius, radius-7, 0, 2*Math.PI);
      ctx.lineWidth = 8;
      ctx.strokeStyle = "#13c1a3";
      ctx.stroke();
    }

    // Initial draw (with -90¬∞ so first segment is up)
    var currentAngle = -Math.PI/2;
    drawWheel(currentAngle);

    // --- Spin Logic ---
    document.getElementById("spinBtn").onclick = function(){
      if (spinning) return;
      spinning = true;
      document.getElementById("resultBox").innerHTML = "Spinning...";
      var seg = Math.floor(Math.random()*n);
      var anglePer = 2*Math.PI/n;
      // Stop so the SEGMENT is exactly at the top (12h)
      var stopAngle = (2*Math.PI*8) - (seg*anglePer + anglePer/2) - Math.PI/2;
      var duration = 2200 + Math.random()*800;
      var start = null;
      var animate = function(ts){
        if(!start) start=ts;
        var elapsed = ts-start;
        var t = Math.min(elapsed/duration,1);
        var ease = 1-Math.pow(1-t,3);
        var angle = currentAngle + (stopAngle-currentAngle)*ease;
        drawWheel(angle);
        if(t<1){
          requestAnimationFrame(animate);
        } else {
          spinning = false;
          currentAngle = stopAngle % (2*Math.PI);
          var item = fishingItems[seg];
          lastResult = item;
          // --- blink the segment ---
          highlightIndex = seg;
          var blinkTimes = 6;
          var blinkCount = 0;
          function blinkLoop(){
            blinkState = !blinkState;
            drawWheel(currentAngle, {i: highlightIndex});
            if(++blinkCount < blinkTimes*2){
              setTimeout(blinkLoop, 140);
            } else {
              blinkState = false;
              drawWheel(currentAngle, {i: highlightIndex});
              renderResult(item);
              addToInventory(item.key);
            }
          }
          blinkLoop();
        }
      }
      requestAnimationFrame(animate);
    }
    // Show previous result if page reload
    if (lastResult) renderResult(lastResult);
  </script>
</body>
</html>
